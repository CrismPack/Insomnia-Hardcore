name: Automatically publish to CurseForge

on:
  release:
    types: [published]

env:
  MC_VERSION: 1.20.1
  RELEASE_TYPE: release
  MODRINTH_TOKEN: ${{ secrets.MODRINTH_TOKEN }}
  CURSEFORGE_TOKEN: ${{ secrets.CURSEFORGE_TOKEN }}

permissions:
  contents: write

jobs:   
  publish-to-curseforge:
    if: github.repository_owner == 'CrismPack'
    runs-on: ubuntu-24.04
    environment: github-actions

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Download pack files
      uses: robinraju/release-downloader@v1.10
      id: download-files
      with:
        fileName: '*.zip'
        latest: true
        tarBall: false
        zipBall: false

    # - name: Publish to CurseForge
    #   uses: henkelmax/upload-curseforge-modpack-action@v1.0.0
    #   with:
    #     api-token: "${{env.CURSEFORGE_TOKEN}}"
    #     project-id: "560596"
    #     modpack-path: "./InsomniaHardcore-${{ env.MC_VERSION }}-${{ steps.download-files.outputs.tag_name }}.zip"
    #     modpack-server-path: "./InsomniaHardcore-ServerPack-${{ env.MC_VERSION }}-${{ steps.download-files.outputs.tag_name }}.zip"
    #     changelog: "./CurseForge-Release.md"
    #     changelog-format: "markdown"
    #     game-version: "${{ env.MC_VERSION }}"
    #     display-name: "Insomnia v${{ steps.download-files.outputs.tag_name }} for ${{ env.MC_VERSION }}"
    #     server-display-name: "Server Pack v${{ steps.download-files.outputs.tag_name }} for ${{ env.MC_VERSION }}"
    #     release-type: "${{ env.RELEASE_TYPE }}"

    - name: Publish to CurseForge
      uses: Kir-Antipov/mc-publish@v3.3
      with:
        name: "Insomnia v${{ steps.download-files.outputs.tag_name }} for ${{ env.MC_VERSION }}"
        changelog-file: CurseForge-Release.md

        curseforge-id: 560596
        curseforge-token: "${{env.CURSEFORGE_TOKEN}}"
        # curseforge-files: |
        #   '!*@(-ServerPack-)*.zip'
        #   '*@(-ServerPack-)*.zip'
        
        files: | 
          "./InsomniaHardcore-${{ env.MC_VERSION }}-${{ steps.download-files.outputs.tag_name }}.zip"
          "./InsomniaHardcore-ServerPack-${{ env.MC_VERSION }}-${{ steps.download-files.outputs.tag_name }}.zip"

        loaders: fabric
        game-versions: ${{ env.MC_VERSION }}


  # publish-to-modrinth:
  #   if: github.repository_owner == 'CrismPack'
  #   runs-on: ubuntu-24.04
  #   environment: github-actions

  #   steps:
  #   - name: Checkout Repository
  #     uses: actions/checkout@v3

  #   - name: Download pack files
  #     uses: robinraju/release-downloader@v1.10
  #     id: download-files
  #     with:
  #       fileName: '*.mrpack'
  #       latest: true
  #       tarBall: false
  #       zipBall: false

  #   - name: Publish to Modrinth
  #     uses: Kir-Antipov/mc-publish@v3.3
  #     with:
  #       name: Breakneck v${{ steps.download-files.outputs.tag_name }} for ${{ vars.MC_VERSION }}
  #       changelog-file: Modrinth-Release.md

  #       modrinth-id: qPrWu8wn
  #       modrinth-token: "${{env.MODRINTH_TOKEN}}"
  #       modrinth-files: '*.mrpack'

  #       loaders: fabric
  #       game-versions: ${{ vars.MC_VERSION }}